databaseChangeLog:
  - changeSet:
      id: 018-add-haittojen-hallinta-fields
      comment: Add fields for managing haittojen hallinta
      author: Niko Junkala
      changes:
        - createTable:
            tableName: haittojenhallinta_kuvaukset
            remarks: "Stores haittojen hallinta kuvaukset as key-value pairs"
            columns:
            - column:
                name: id
                type: bigint
                constraints:
                  primaryKey: true
            - column:
                name: haittojenhallinta_id
                type: bigint
                constraints:
                  nullable: false
            - column:
                name: key
                remarks: "Haittojen hallinta description key. Uses values of enum HaittojenHallintaKentta."
                type: varchar(64) # enum HaittojenHallintaKentta
                constraints:
                  nullable: false
            - column:
                name: value
                remarks: "Haittojen hallinta description. Free text."
                type: text

        - addUniqueConstraint:
            tableName: haittojenhallinta_kuvaukset
            columnNames: haittojenhallinta_id, key
            constraintName: "ck_haittojenhallinta_kuvaukset_haittojenhallinta_id_key"

        - createTable:
            tableName: haittojenhallinta
            remarks: "Stores haittojen hallinta. This is to be used with Hanke and Hakemus."
            columns:
              - column:
                  name: id
                  type: bigint
                  constraints:
                    primaryKey: true
              - column:
                  name: kuvaukset_id
                  remarks: "References descriptions"
                  type: bigint
                  constraints:
                    referencedTableName: "haittojenhallinta_kuvakset"
                    foreignKeyName: "haittojenhallinta_id"

        - addColumn:
            tableName: hanke
            columns:
              - column:
                  name: haittojenhallinta_id
                  type: bigint
                  constraints:
                    foreignKeyName: fk_hanke_haittojenhallinta
                    referencedTableName: haittojenhallinta
                    referencedColumnNames: id

        - addAutoIncrement:
            tableName: haittojenhallinta
            columnName: id
            columnDataType: bigint
            generationType: ALWAYS

        - addAutoIncrement:
            tableName: haittojenhallinta_kuvaukset
            columnName: id
            columnDataType: bigint
            generationType: ALWAYS
            